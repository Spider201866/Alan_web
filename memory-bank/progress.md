<!-- Alan UI - progress.md | Updated 14th January 2026, Cline -->

# Progress

This file tracks what works, what changed recently, and what’s next.
Deep architecture details live in `systemPatterns.md` / `techContext.md`.

---

## Current Status (as of 12 Jan 2026)
- Stable, accessible PWA.
- Dev serves `public/`; prod serves `dist/` generated by `npm run build`.
- CI runs `npm test` (build + formatting + translations + a11y + jest).

## Current Status (as of 14 Jan 2026)
- Security posture strengthened (client-side injection hardening, additional headers, safer admin session cookies).
- Test suite expanded and made less noisy/brittle.

---

## Recent Changes

### January 2026 Maintenance (14 Jan 2026)
- **Client-side injection hardening**
  - Introduced `public/scripts/trusted-html.js` for *trusted* markup insertion (sanitizes scripts, inline events, javascript: URLs; adds rel for target=_blank).
  - Replaced `innerHTML` usage for translations and UI injection where appropriate.
- **Admin hardening**
  - Admin session cookie TTL reduced to 15 minutes; production cookie name uses `__Host-` prefix.
  - Service worker bypasses `/api/*` caching.
- **Server hardening**
  - Added Permissions-Policy and additional low-risk security headers.
- **Testing improvements**
  - Added `tests/api/security-headers.test.js`.
  - `scripts/test-a11y.mjs` now stubs canvas context to avoid noisy warnings.
  - `tests/api/build.test.js` now checks for expected output files rather than brittle size comparisons.

### January 2026 Maintenance (11–12 Jan 2026)
- **Flowise proxy reliability**
  - Proxy is mounted early so request streams are readable.
  - Abort logic avoids aborting on normal request completion.
- **Environment-driven client logging**
  - Production builds inject `<meta name="alanui-env" content="production">`.
  - Client `log.js` uses this marker instead of hostname.
- **Build-stamped service worker cache name**
  - `scripts/build.js` stamps a unique cache name into `dist/service-worker.js`.
  - Removes need to manually bump `CACHE_NAME` per release.
- **CI/build hygiene**
  - Verbose build output gated behind `BUILD_DEBUG=true`.
  - CI made more resilient to dependency/a11y script dependency drift.

### January 2026 Developer Workflow Hygiene (12 Jan 2026)
- Added repo-level PowerShell guardrails:
  - `.clinerules/reminders.md` bans CMD-only syntax and documents PowerShell gotchas.
- Added a sanity skill:
  - `.clinerules/skills/powershell-sanity-checklist/SKILL.md`
    - Checks PowerShell basics, curl alias pitfalls, git metadata (`.git` vs `.git_disabled`).

---

## Backlog / Action Items (Prioritized)
1) **.gitignore hygiene**
   - Ensure local DBs (`alan-data.db`, `test-alan-data.db`) and `dist/` are ignored.
2) **(Optional) CSRF enablement in production**
   - `ENABLE_CSRF=true` and confirm client sends `x-csrf-token` for mutating requests.
3) **UX consistency**
   - Ensure a single handler path for the `instructions-button`.
4) **Docs hygiene**
   - Remove stale references (e.g. scripts referenced in older notes that no longer exist).

---

## What Works (Confirmed)
- PWA: offline fallback, caching strategies, install prompt handling.
- Accessibility: focus traps, skip links, translated content, keyboard navigation.
- Security: strict CSP, rate limiting, PBKDF2 auth, optional CSRF.
- Data: SQLite persistence with environment-specific DB path.
- Testing: Jest + JSDOM + API tests; a11y tests on built `dist/*.html`.

---

## Historical Notes (Archived)

<details>
<summary>September 2025 review (15 Sep 2025)</summary>

- Full codebase review performed (backend/frontend/PWA/build/tests).
- Confirmed orchestrator + modular frontend pattern.
- Confirmed service worker bypass for admin `view-records.html` and SW_READY handshake.
- Expanded Memory Bank to document confirmed patterns.

</details>

<details>
<summary>July 2025 highlights</summary>

- Records page fixes (date display + CSP adjustments).
- Chat prompt marquee hiding reliability improvements.
- Screenshot functionality fix.
- Auth hashing alignment between generator and middleware.
- Image optimisation to WebP and on-demand loading improvements.

</details>
