<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Alan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles_index.css" />

    <!-- 1) Import translations from language.js (ES modules) -->
    <script type="module">
      import { translations } from './language.js';
      // Make translations available globally.
      window.translations = translations;
    </script>
  </head>
  <body>
<!-- ===================================================================== -->
<!-- PASSWORD SCREEN (initially hidden) -->
<!-- ===================================================================== -->
<div class="password-screen hidden" id="passwordScreen" style="position: relative">
  <!-- Language selector button & dropdown (22 languages) -->
  <div style="text-align: center; margin-bottom: 60px">
    <div
      id="language-selector-text"
      style="cursor: pointer; margin-bottom: 10px; font-size: 14px; color: #000"
      onclick="document.getElementById('index-language-button').click()"
    >
      中文, हिन्दी, Español, العربية, Français...
    </div>
    <button
      id="index-language-button"
      title="Choose language"
      style="
        background: url('lang.jpg') no-repeat center center;
        background-size: cover;
        width: 64px;
        height: 64px;
        border: 3px solid #3e3e3e;
        cursor: pointer;
      "
    ></button>
    <div
      id="index-language-dropdown"
      style="
        display: none;
        position: absolute;
        top: 40px;
        left: 50%;
        transform: translateX(-50%);
        background: #fff;
        border: 1px solid #ccc;
        z-index: 9999;
        min-width: 220px;
        white-space: nowrap;
        max-height: 350px;
        overflow-y: auto;
        font-size: 14px;
        line-height: 1.2;
      "
    >
      <ul style="margin: 0; padding: 0; list-style: none">
        <li data-value="en" style="padding: 6px; cursor: pointer"><strong>English</strong> (English)</li>
        <li data-value="zh" style="padding: 6px; cursor: pointer"><strong>中文</strong> (Chinese)</li>
        <li data-value="hi" style="padding: 6px; cursor: pointer"><strong>हिन्दी</strong> (Hindi)</li>
        <li data-value="es" style="padding: 6px; cursor: pointer"><strong>Español</strong> (Spanish)</li>
        <li data-value="ar" style="padding: 6px; cursor: pointer"><strong>العربية</strong> (Arabic)</li>
        <li data-value="fr" style="padding: 6px; cursor: pointer"><strong>Français</strong> (French)</li>
        <li data-value="bn" style="padding: 6px; cursor: pointer"><strong>বাংলা</strong> (Bangla)</li>
        <li data-value="pt" style="padding: 6px; cursor: pointer"><strong>Português</strong> (Portuguese)</li>
        <li data-value="id" style="padding: 6px; cursor: pointer"><strong>Bahasa Indonesia</strong> (Indonesian)</li>
        <li data-value="sw" style="padding: 6px; cursor: pointer"><strong>Kiswahili</strong> (Swahili)</li>
        <li data-value="ur" style="padding: 6px; cursor: pointer"><strong>اردو</strong> (Urdu)</li>
        <li data-value="fa" style="padding: 6px; cursor: pointer"><strong>فارسی</strong> (Persian)</li>
        <li data-value="ln" style="padding: 6px; cursor: pointer"><strong>Lingala</strong> (Lingala)</li>
        <li data-value="ha" style="padding: 6px; cursor: pointer"><strong>Hausa</strong> (Hausa)</li>
        <li data-value="yo" style="padding: 6px; cursor: pointer"><strong>Yorùbá</strong> (Yoruba)</li>
        <li data-value="ig" style="padding: 6px; cursor: pointer"><strong>Igbo</strong> (Igbo)</li>
        <li data-value="zu" style="padding: 6px; cursor: pointer"><strong>Zulu</strong> (Zulu)</li>
        <li data-value="am" style="padding: 6px; cursor: pointer"><strong>አማርኛ</strong> (Amharic)</li>
        <li data-value="sn" style="padding: 6px; cursor: pointer"><strong>chiShona</strong> (Shona)</li>
        <li data-value="rw" style="padding: 6px; cursor: pointer"><strong>Ikinyarwanda</strong> (Kinyarwanda)</li>
        <li data-value="ny" style="padding: 6px; cursor: pointer"><strong>Chichewa</strong> (Chichewa)</li>
        <li data-value="cy" style="padding: 6px; cursor: pointer"><strong>Cymraeg</strong> (Welsh)</li>
      </ul>
    </div>
  </div>

  <!-- Password Screen Heading -->
  <h2 id="password-title" style="margin-bottom: 40px; font-weight: normal; font-size: 17px; text-align: center;">
    Enter your <span style="font-weight: bold; font-family: 'Quicksand', sans-serif"><span style="color: red">Al</span>an</span> invitation password
  </h2>

  <!-- Password Input and Submit Button -->
  <div style="display: flex; justify-content: center; align-items: flex-start; margin-bottom: 20px">
    <div style="display: flex; flex-direction: column; margin-right: 30px">
      <input
        type="password"
        id="passwordInput"
        placeholder="Password"
        style="color: grey; padding: 12px; width: 150px; font-size: 16px; border-radius: 14px; border: 2px solid #ccc; margin-bottom: 20px"
      />
      <p id="passwordError" style="color: red; display: none; width: 220px; text-align: center; margin: 6px auto 0">
        Invalid password. Please try again
      </p>
    </div>
    <button id="passwordSubmitBtn" disabled style="padding: 12px; font-size: 16px; border-radius: 12px; border: 1px solid #ccc; cursor: pointer">
      Submit
    </button>
  </div>

  <!-- Small Note -->
  <p id="noCodeLine" style="margin-top: 50px; font-style: italic; font-size: 14px; color: black; text-align: center">
    No or incorrect code? Contact us <a href="https://medicine.st-andrews.ac.uk/arclight/contact/" style="color: blue" target="_blank">here</a>
  </p>
</div>
<!-- END PASSWORD SCREEN -->


    <!-- ===================================================================== -->
    <!-- SPLASH SCREEN (initially visible only via JS) -->
    <!-- ===================================================================== -->
    <div class="splash-screen hidden">
      <img id="logo1" src="./Q.png" alt="Q Logo" />
      <img id="logo2" src="./AP.png" alt="AP Logo" />
      <p>Eye, Ear, Skin AI Assistant</p>
    </div>

    <!-- ===================================================================== -->
    <!-- ONBOARDING (INSTRUCTION) SCREEN (initially hidden) -->
    <!-- ===================================================================== -->
    <div class="instruction-screen hidden">
      <img
        src="bigredt.png"
        alt="Big Red T Logo"
        style="max-width: 120px; height: auto; margin-bottom: -10px"
      />

      <p id="instruction-text" style="text-align: justify">
        Alan is an AI assistant for students and those who only occasionally see eye, ear or skin cases. Write or speak clearly
        and avoid identifying names or details.
      </p>

      <p id="good-luck" class="good-luck" style="text-align: center">Good luck!</p>

      <!-- (1) NAME INPUT: width = 180px, left-aligned -->
      <input
        type="text"
        id="nameInput"
        class="name-input"
        placeholder="Name"
        title="2-20 letters, spaces, apostrophes or hyphens only"
        style="
          color: grey;
          text-align: left;
          width: 220px;
        "
      />

      <!-- (2) AIMS SELECT (formerly ROLE): width = 180px, left-aligned -->
      <select
        id="job-role-select" 
        class="job-role-dropdown"
        style="
          text-align: left;
          width: 220px;
        "
      >
        <option value="" disabled selected hidden>Aims</option> <!-- Changed placeholder text -->
        <option value="Eyes">Eyes</option>
        <option value="Ears">Ears</option>
        <option value="Skin">Skin</option>
        <option value="Veterinary">Veterinary</option>
        <option value="Child/Maternal">Child/Maternal</option>
        
        <!-- 
        <option value="Health worker">Health worker</option>
        <option value="Nurse">Nurse</option>
        <option value="Ophthalmic clinical officer">Ophthalmic clinical officer</option>
        <option value="Medical student">Medical student</option>
        <option value="Physician associate">Physician associate</option>
        <option value="General practitioner">General practitioner</option>
        <option value="Hospital doctor">Hospital doctor</option>
        <option value="Ophthalmologist">Ophthalmologist</option>
        <option value="Optometrist">Optometrist</option>
        <option value="Orthoptist">Orthoptist</option>
        <option value="ENT specialist">ENT specialist</option>
        <option value="Pharmacist">Pharmacist</option>
        <option value="Audiologist">Audiologist</option>
        <option value="Ear care practitioner">Ear care practitioner</option>
        <option value="Dermatologist">Dermatologist</option>
         -->
      </select>

      <!-- (3) EXPERIENCE SELECT: width = 180px, left-aligned -->
      <select
        id="experience-select"
        class="experience-dropdown"
        style="
          text-align: left;
          width: 220px;
        "
      >
        <option value="" disabled selected hidden>Experience</option>
        <option value="Student / refresher">Student / refresher</option>
        <option value="Confident core knowledge">Confident core knowledge</option>
        <option value="Expert">Expert</option>
      </select>

      <!-- (4) AIMS BUTTON REMOVED -->

      <!-- (5) CONTACT INPUT: width = 180px, left-aligned -->
      <input
        type="text"
        id="contactInput"
        class="contact-input"
        placeholder="Contact (email/phone)"
        autocomplete="off"
        autocorrect="off"
        autocapitalize="off"
        spellcheck="false"
        style="
          text-align: left;
          width: 220px;
        "
      />

      <br /><br /><br />

      <!-- (Accept button unchanged) -->
      <button
        id="acceptButton"
        disabled
        style="
          display: inline-flex;
          align-items: center;
          justify-content: flex-start;
          text-align: left;
          appearance: none;
          -webkit-appearance: none;
        "
      >
        Accept
      </button>

      <br />
      <div id="locationInfo" style="display: none"></div>
    </div>
    <!-- END ONBOARDING SCREEN -->

    <!-- ===================================================================== -->
    <!-- BLACK SCREEN OVERLAY (Transition to Home) -->
    <!-- ===================================================================== -->
<div 
  class="black-screen" 
  id="blackScreen" 
  style="
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%;
    background: black;
    z-index: 9999;
    visibility: hidden;
    opacity: 0;
    transition: visibility 0s, opacity 1s ease;
    display: flex; 
    justify-content: center; 
    align-items: center;
  "
>
  <iframe
    id="triangleFrame"
    src="triangle.html"
    style="
      border: none;
      width: clamp(180px, 50vw, 300px);
      height: clamp(180px, 50vw, 300px);
      transform: scale(1);
      transition: transform 4s ease-in-out, filter 4s ease-in-out;
      transform-origin: center center;
    "
  ></iframe>
</div>


    <!-- ===================================================================== -->
    <!-- MAIN SCRIPT -->
    <!-- ===================================================================== -->
    <script>
      /*********************************************/
      /*           GLOBAL REFERENCES             */
      /*********************************************/
      const passwordScreen = document.getElementById('passwordScreen');
      const passwordInput = document.getElementById('passwordInput');
      const passwordSubmitBtn = document.getElementById('passwordSubmitBtn');
      const passwordError = document.getElementById('passwordError');

      const splashScreenRef = document.querySelector('.splash-screen');
      const instructionRef = document.querySelector('.instruction-screen');
      const blackScreen = document.getElementById('blackScreen');
      const skyImage = document.getElementById('triangleFrame'); 

      const nameInput = document.getElementById('nameInput');
      const jobSelectElement = document.getElementById('job-role-select'); // This ID now refers to the "Aims" dropdown
      const experienceSelect = document.getElementById('experience-select');
      const contactInput = document.getElementById('contactInput');
      const acceptButton = document.getElementById('acceptButton');

      let ipLatitude = 'Not set';
      let ipLongitude = 'Not set';
      let ipCountry = 'Not set';
      let ipArea = 'Not set';
      let ipISO2 = 'Not set';

      const classificationLookup = {
        HI: ['QA', 'MO', 'LU', 'SG', 'BN', 'IE', 'NO', 'KW', 'AE', 'CH', 'HK', 'SM', 'US', 'SA', 'NL', 'IS', 'BH', 'SE', 'DE', 'AU', 'TW', 'DK', 'AT', 'CA', 'BE', 'OM', 'FI', 'GB', 'FR', 'JP', 'MT', 'KR', 'NZ', 'ES', 'IT', 'PR', 'CY', 'IL', 'CZ'],
        MI: ['GQ', 'SI', 'SK', 'LT', 'EE', 'TT', 'PT', 'PL', 'HU', 'MY', 'SC', 'RU', 'GR', 'LV', 'KN', 'AG', 'TR', 'KZ', 'BS', 'CL', 'PA', 'HR', 'RO', 'UY', 'MU', 'BG', 'AR', 'IR', 'MX', 'LB', 'GA', 'MV', 'TM', 'BY', 'BW', 'TH', 'CN', 'BR', 'ZA', 'IN'],
        LI: ['BB', 'ME', 'AZ', 'CR', 'IQ', 'DO', 'PW', 'MK', 'RS', 'DZ', 'GD', 'CO', 'SR', 'LC', 'PE', 'LK', 'EG', 'MN', 'JO', 'AL', 'VE', 'ID', 'DM', 'XK', 'NR', 'TN', 'VC', 'NA', 'BA', 'EC', 'GE', 'SZ', 'FJ', 'LY', 'PY', 'JM', 'AM', 'SV', 'BT', 'UA', 'MA', 'BZ', 'GY', 'PH', 'GT', 'BO', 'LA', 'UZ', 'CV', 'VN', 'PK'],
        VLI: ['AO', 'CG', 'MM', 'NG', 'NI', 'WS', 'MD', 'TO', 'HN', 'TL', 'GH', 'SD', 'BD', 'MR', 'KH', 'ZM', 'LS', 'CI', 'TV', 'PG', 'KG', 'DJ', 'KE', 'MH', 'FM', 'CM', 'TZ', 'ST', 'TJ', 'VU', 'NP', 'SN', 'TD', 'UG', 'YE', 'ZW', 'BJ', 'ML', 'SB', 'ET', 'RW', 'GN', 'KI', 'AF', 'BF', 'HT', 'GW', 'SL', 'GM', 'SS', 'TG', 'KM', 'MG', 'ER', 'MZ', 'MW', 'NE', 'LR', 'BI', 'CD', 'CF']
      };

      function setSelectedAgent() {
        let selectedAgent = 'Unknown';
        const classification = localStorage.getItem('classification') || 'Unknown';
        const roleClass = localStorage.getItem('roleClassification') || '';

        if (roleClass === ' (M)' && ['HI', 'MI'].includes(classification)) {
          selectedAgent = 'Agent 1';
        } else if (roleClass === ' (M)' && ['LI', 'VLI'].includes(classification)) {
          selectedAgent = 'Agent 3';
        } else if (roleClass === ' (P)' && ['HI', 'MI'].includes(classification)) {
          selectedAgent = 'Agent 2';
        } else if (roleClass === ' (P)' && ['LI', 'VLI'].includes(classification)) {
          selectedAgent = 'Agent 4';
        }
        localStorage.setItem('selectedAgent', selectedAgent);
      }

      function showSplashScreenAndThen() {
        splashScreenRef.classList.remove('hidden');
        splashScreenRef.classList.add('visible');
        const logo1 = document.getElementById('logo1');
        const logo2 = document.getElementById('logo2');
        logo1.style.transform = 'scale(0.8)';
        logo2.style.transform = 'rotateX(-90deg)';
        setTimeout(() => {
          logo1.style.transform = 'scale(1)';
          logo2.style.transform = 'rotateX(0deg)';
        }, 100);
        setTimeout(() => {
          splashScreenRef.classList.remove('visible');
          splashScreenRef.classList.add('hidden');
          if (localStorage.getItem('verified') === 'true') {
            instructionRef.classList.remove('hidden');
            instructionRef.classList.add('visible');
          } else {
            passwordScreen.classList.remove('hidden');
            passwordScreen.classList.add('visible');
          }
        }, 4000);
      }

      function fetchIPBasedLocation() {
        fetch('https://ipapi.co/json/')
          .then(response => response.json())
          .then(data => {
            if (data) {
              ipLatitude = data.latitude || 'Not set';
              ipLongitude = data.longitude || 'Not set';
              ipCountry = data.country_name || 'Not set';
              ipArea = data.city || 'Not set';
              ipISO2 = (data.country || 'Not set').toUpperCase();
              localStorage.setItem('latitude', ipLatitude);
              localStorage.setItem('longitude', ipLongitude);
              localStorage.setItem('country', ipCountry);
              localStorage.setItem('area', ipArea);
              localStorage.setItem('iso2', ipISO2);
              storeClassifications(ipISO2);
            }
          })
          .catch(error => console.error('Error fetching IP-based location:', error));
      }

      function storeClassifications(iso2) {
        let classification = 'Unknown';
        for (const [key, values] of Object.entries(classificationLookup)) {
          if (values.includes(iso2)) {
            classification = key;
            break;
          }
        }
        localStorage.setItem('classification', classification);
      }

      function checkSelections() {
        jobSelectElement.style.color = jobSelectElement.value ? 'blue' : 'grey'; // jobSelectElement now "Aims"
        experienceSelect.style.color = experienceSelect.value ? 'blue' : 'grey';
        nameInput.style.color = nameInput.value.trim().length >= 2 ? 'blue' : 'grey';
        
        acceptButton.disabled = !(
          nameInput.value.trim() &&
          jobSelectElement.value && // Checks if an "Aim" is selected
          experienceSelect.value &&
          contactInput.value.trim()
        );
      }

      function initEventListeners() {
        skyImage.style.transform = 'scale(1)';
        skyImage.style.transition = 'transform 4s ease-in-out, filter 4s ease-in-out';

        nameInput.addEventListener('input', (e) => {
          e.target.value = e.target.value.replace(/[^A-Za-z'\- ]/g, '');
          if (e.target.value.length > 20) {
            e.target.value = e.target.value.substring(0, 20);
          }
          checkSelections();
        });

        jobSelectElement.addEventListener('change', checkSelections); // jobSelectElement now "Aims"
        experienceSelect.addEventListener('change', checkSelections);
        contactInput.addEventListener('input', () => {
          contactInput.classList.toggle('entered', contactInput.value.trim() !== '');
          checkSelections();
        });

        acceptButton.addEventListener('click', handleAccept);

        passwordInput.addEventListener('input', () => {
          passwordSubmitBtn.disabled = passwordInput.value.trim() === '';
          passwordError.style.display = 'none';
        });
        passwordSubmitBtn.addEventListener('click', verifyPassword);
      }

      function verifyPassword() {
        const entered = passwordInput.value.trim();
        fetch('/fetch-records', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password: entered }),
        })
          .then(response => {
            if (!response.ok) throw new Error('Invalid password');
            localStorage.setItem('verified', 'true');
            passwordScreen.classList.remove('visible');
            passwordScreen.classList.add('hidden');
            instructionRef.classList.remove('hidden');
            instructionRef.classList.add('visible');
          })
          .catch(err => {
            passwordError.style.display = 'block';
            passwordInput.value = '';
            passwordSubmitBtn.disabled = true;
            setTimeout(() => { passwordError.style.display = 'none'; }, 3000);
          });
      }

      function handleAccept() {
        const rawName = nameInput.value.trim();
        const nameIsValid = /^[A-Za-z'\- ]{2,20}$/.test(rawName);
        if (!nameIsValid) {
          alert('Please enter a valid name (2-20 letters, spaces, apostrophes or hyphens).');
          return;
        }

        localStorage.setItem('name', rawName);
        localStorage.setItem('selectedJobRole', jobSelectElement.value); // Storing selected "Aim" under selectedJobRole key
        localStorage.setItem('selectedExperience', experienceSelect.value);

        let roleClass;
        const selectedAim = jobSelectElement.value; // This is the new "Aim" value
        
        // CRITICAL: Adjust this logic based on how new "Aims" map to (M) or (P)
        switch (selectedAim) {
          case 'Eyes':
          case 'Ears':
          case 'Skin':
          case 'Child/Maternal': // Example: Assuming Child/Maternal is Medical
            roleClass = ' (M)';
            break;
          case 'Veterinary': // Example: Assuming Veterinary is Paramedical or other
            roleClass = ' (P)'; 
            break;
          default: // Default or if an Aim doesn't clearly map
            roleClass = ' (P)'; // Or ' (M)' or handle as unknown
            break;
        }
        localStorage.setItem('roleClassification', roleClass);
        localStorage.setItem('contactInfo', contactInput.value);

        if (!localStorage.getItem('sessionId')) {
          localStorage.setItem('sessionId', `user-${Date.now()}`);
        }
        setSelectedAgent();

        const userInfo = {
          sessionId: localStorage.getItem('sessionId'),
          name: rawName,
          role: jobSelectElement.value, // This will be the "Aim" (e.g., "Eyes", "Veterinary")
          experience: experienceSelect.value,
          latitude: localStorage.getItem('latitude'),
          longitude: localStorage.getItem('longitude'),
          country: localStorage.getItem('country'),
          iso2: localStorage.getItem('iso2'),
          classification: localStorage.getItem('classification'),
          area: localStorage.getItem('area'),
          contactInfo: contactInput.value,
          version: localStorage.getItem('version') || '1.0',
          selectedAgent: localStorage.getItem('selectedAgent'),
          dateTime: new Date().toLocaleString('en-GB', { timeZone: 'UTC' })
        };

        fetch('https://alan.up.railway.app/record-info', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(userInfo)
        })
          .then(resp => resp.text())
          .then(data => console.log('Record saved:', data))
          .catch(err => console.error('Error saving record:', err));

        const sessionId = localStorage.getItem('sessionId') || 'no-session-id';
        fetch('https://flowiseai-railway-production-fecf.up.railway.app/api/v1/prediction/75b5edc0-4e39-441b-ba7a-eb6cb404b69a', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            question: 'Hello, how can I help?',
            overrideConfig: { sessionId: sessionId }
          })
        })
          .then(response => response.json())
          .then(data => console.log('Flowise API response:', data))
          .catch(error => console.error('Error:', error));

        blackScreen.style.visibility = 'visible';
        blackScreen.style.opacity = 1;
        setTimeout(() => {}, 200);
        setTimeout(() => {
          blackScreen.style.opacity = 0;
          setTimeout(() => { window.location.href = 'home.html'; }, 250);
        }, 6000);
      }

      function main() {
        showSplashScreenAndThen();
        fetchIPBasedLocation();
        initEventListeners();

        const indexLangButton = document.getElementById('index-language-button');
        const indexLangDropdown = document.getElementById('index-language-dropdown');
        indexLangButton.addEventListener('click', () => {
          indexLangDropdown.style.display = (indexLangDropdown.style.display === 'none' || indexLangDropdown.style.display === '') ? 'block' : 'none';
        });
        indexLangDropdown.querySelectorAll('li').forEach(item => {
          item.addEventListener('click', () => {
            const chosenLang = item.getAttribute('data-value');
            localStorage.setItem('preferredLanguage', chosenLang);
            updateIndexLanguageDisplays(chosenLang);
            indexLangDropdown.style.display = 'none';
          });
        });
      }

      document.addEventListener('DOMContentLoaded', main);

      function updateIndexLanguageDisplays(lang) {
        if (!window.translations || !window.translations[lang]) {
          console.warn(`Translations for language '${lang}' not found.`);
          return;
        }
        const currentTranslations = window.translations[lang];

        document.getElementById('password-title').textContent = currentTranslations.passwordTitle;
        document.getElementById('passwordInput').placeholder = currentTranslations.passwordPlaceholder;
        document.getElementById('passwordError').textContent = currentTranslations.passwordErrorMsg;
        document.getElementById('passwordSubmitBtn').textContent = currentTranslations.passwordSubmitBtn;
        document.getElementById('noCodeLine').innerHTML = currentTranslations.noCodeLine;

        document.getElementById('instruction-text').textContent = currentTranslations.instructionText;
        document.getElementById('good-luck').textContent = currentTranslations.goodLuck;
        document.getElementById('nameInput').placeholder = currentTranslations.namePlaceholder;

        // Update "Aims" dropdown (formerly "Role")
        // Use a new translation key for "Aims" placeholder, e.g., aimsPlaceholder
        document.querySelector('#job-role-select option[disabled]').textContent = currentTranslations.aimsPlaceholder || 'Aims'; 

        // Update new "Aims" options
        const aimsOptionsMapping = {
          "Eyes": currentTranslations.aimsEyes,
          "Ears": currentTranslations.aimsEars,
          "Skin": currentTranslations.aimsSkin,
          "Veterinary": currentTranslations.aimsVeterinary,
          "Child/Maternal": currentTranslations.aimsChildMaternal
        };
        document.querySelectorAll('#job-role-select option:not([disabled])').forEach(option => {
          // Only update if it's one of the new "Aims" options
          if (aimsOptionsMapping[option.value]) {
            option.textContent = aimsOptionsMapping[option.value];
          } else if (!option.outerHTML.includes("<!--")) { 
            // Fallback for new options if translation missing, but skip commented out ones
            option.textContent = option.value; 
          }
        });
        
        // Logic for old job role translations is still here but won't apply to visible options
        // const roleOptions = document.querySelectorAll('#job-role-select option:not([disabled])');
        // roleOptions.forEach((option) => { ... }); // This part is now less relevant for visible items

        document.querySelector('#experience-select option[disabled]').textContent = currentTranslations.experiencePlaceholder;
        const expOptionsMapping = {
          "Student / refresher": currentTranslations.experienceStudentRefresher,
          "Confident core knowledge": currentTranslations.experienceConfidentCore,
          "Expert": currentTranslations.experienceExpert
        };
        document.querySelectorAll('#experience-select option:not([disabled])').forEach(option => {
          if (expOptionsMapping[option.value]) {
            option.textContent = expOptionsMapping[option.value];
          } else {
            option.textContent = option.value; 
          }
        });
        
        const contactInputEl = document.getElementById('contactInput');
        contactInputEl.placeholder = currentTranslations.contactPlaceholder;
        document.getElementById('acceptButton').textContent = currentTranslations.acceptButton;
      }
    </script>
  </body>
</html>