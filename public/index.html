<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Splash Screen</title>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: "Calibri Light", Arial, sans-serif;
            background-color: #f0f0f0;
            box-sizing: border-box;
        }
        .black-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.50s ease-in-out;
        }
        .black-screen.visible {
            visibility: visible;
            opacity: 1;
        }
        .black-screen img {
            width: auto;
            max-width: 30%;
            height: auto;
            filter: blur(20px);
            transition: transform 4s ease-in-out, filter 4s ease-in-out;
        }
        .hidden {
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s 0.5s, opacity 0.5s linear;
        }
        .visible {
            visibility: visible;
            opacity: 1;
            transition: opacity 0.5s linear;
        }
        button:disabled {
            background-color: #ccc;
        }
        .splash-screen img,
        .splash-screen p {
            transition: transform 3s ease-in-out;
            margin: 20px 0;
        }
        .splash-screen img {
            width: 30vw;
            max-width: 150px;
            height: auto;
            margin-bottom: 60px;
            transform-origin: center;
            -webkit-transform-origin: center;
        }
        @keyframes zoomEffect {
            from {
                transform: scale(0.8);
                -webkit-transform: scale(0.8);
            }
            to {
                transform: scale(1);
                -webkit-transform: scale(1);
            }
        }
        .splash-screen.visible img {
            animation: zoomEffect 3s ease-in-out forwards;
        }
        .splash-screen,
        .instruction-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .splash-screen img,
        .splash-screen p {
            transition: transform 3s ease-in-out;
            margin: 20px 0;
        }
        .splash-screen img {
            width: 30vw;
            max-width: 150px;
            height: auto;
            margin-bottom: 60px;
        }
        #logo2 {
            width: 50vw;
            max-width: 300px;
            margin-bottom: 60px;
        }
        .splash-screen p {
            font-size: calc(12px + 1vmin);
            font-weight: bold;
            font-style: italic;
            margin-top: 60px;
        }
        .instruction-screen {
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: white;
            overflow: auto;
            box-sizing: border-box;
        }
        .instruction-screen p {
    font-size: 16px;
    margin: 10px 20px; /* Adjusted margin to reduce gap */
    color: #333;
}

.instruction-screen p.good-luck {
    margin-bottom: 20px; /* Add space after "Good luck!" */
}

        
        button {
            padding: 10px 20px;
            font-size: 16px;
            color: white;
            background-color: #007bff;
            border: none;
            border-radius: 15px;
            cursor: pointer;
        }
        button:disabled {
            background-color: #ccc;
        }
        select, .geo-button, .name-input {
    padding: 4px 20px;
    font-size: 14px;
    color: grey;
    background-color: white;
    border: 1px solid grey;
    cursor: pointer;
    border-radius: 15px;
    width: 230px; /* Set a fixed width for all elements */
    box-sizing: border-box; /* Include padding and border in the element's total width */
    text-align: center;
    margin-bottom: 20px;
}
select {
    appearance: none;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"><path d="M7 10l5 5 5-5H7z"/></svg>');
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 25px;
    max-height: 300px;
    line-height: 1.2;
}
.geo-button.clicked, .name-input.entered {
    color: blue;
}


    </style>
</head>
<body>
    <div class="splash-screen visible">
        <img id="logo1" src="./Q.png" alt="Q Logo" />
        <img id="logo2" src="./AP.png" alt="AP Logo" />
        <p>Eye & Ear AI Assistant</p>
    </div>

    <div class="instruction-screen hidden">
        <img src="bigredt.png" alt="Big Red T Logo" style="max-width: 120px; height: auto; margin-bottom: -10px" />
        <p>Alan is an AI assistant for students and those who only occasionally see eye or ear cases. Write or speak clearly and avoid identifying names or details.</p>
        <p class="good-luck">Good luck!</p>
        

        <input type="text" id="nameInput" class="name-input" placeholder="Name">

        <select id="job-role-select" class="job-role-dropdown">
            <option value="" disabled selected hidden>Role</option>
            <option value="Health worker">Health worker</option>
            <option value="Nurse">Nurse</option>
            <option value="Ophthalmic clinical officer">Ophthalmic clinical officer</option>
            <option value="Medical student">Medical student</option>
            <option value="General practitioner">General practitioner</option>
            <option value="Hospital doctor">Hospital doctor</option>
            <option value="Ophthalmologist">Ophthalmologist</option>
            <option value="Optometrist">Optometrist</option>
            <option value="Orthoptist">Orthoptist</option>
            <option value="ENT specialist">ENT specialist</option>
            <option value="Pharmacist">Pharmacist</option>
            <option value="Audiologist">Audiologist</option>
            <option value="Ear care practitioner">Ear care practitioner</option>
        </select>

        <button id="geolocationButton" class="geo-button">Geolocation On</button>

        <br /><br /><br />
        <button id="acceptButton" disabled>Accept</button>
        <br />
        <div id="locationInfo" style="display:none;"></div>
    </div>

    <div class="black-screen" id="blackScreen">
        <img src="./sky.png" alt="Sky">
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const nameInput = document.getElementById("nameInput");
            const jobSelectElement = document.getElementById("job-role-select");
            const geolocationButton = document.getElementById("geolocationButton");
            const acceptButton = document.getElementById("acceptButton");
            const locationInfo = document.getElementById("locationInfo");
            const blackScreen = document.getElementById("blackScreen");
            const skyImage = blackScreen.querySelector('img');
            let locationAccepted = false;
    
            // Initial setup for the image transformation
            skyImage.style.transform = 'scale(1)';
            skyImage.style.transition = 'transform 4s ease-in-out, filter 4s ease-in-out';
    
            nameInput.addEventListener("input", function() {
                nameInput.classList.toggle('entered', nameInput.value.trim() !== '');
                checkSelections();
            });
            jobSelectElement.addEventListener("change", checkSelections);
    
            function checkSelections() {
                jobSelectElement.style.color = jobSelectElement.value ? 'blue' : 'grey';
                acceptButton.disabled = !(nameInput.value.trim() && jobSelectElement.value && locationAccepted);
            }
    
            geolocationButton.addEventListener("click", function () {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(showPosition, showError);
                } else {
                    locationInfo.innerText = 'Geolocation is not supported by this browser.';
                    locationInfo.style.display = 'block';
                }
            });
    
            function showPosition(position) {
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;
                localStorage.setItem("latitude", latitude);
                localStorage.setItem("longitude", longitude);
                fetchCountryFromLatLong(latitude, longitude);
                geolocationButton.classList.add('clicked');
                locationAccepted = true;
                checkSelections();
            }
    
            function showError(error) {
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        locationInfo.innerText = 'User denied the request for Geolocation.';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        locationInfo.innerText = 'Location information is unavailable.';
                        break;
                    case error.TIMEOUT:
                        locationInfo.innerText = 'The request to get user location timed out.';
                        break;
                    case error.UNKNOWN_ERROR:
                        locationInfo.innerText = 'An unknown error occurred.';
                        break;
                }
                locationInfo.style.display = 'block';
            }
    
            function fetchCountryFromLatLong(latitude, longitude) {
                const OPEN_CAGE_API_KEY = 'b4217f147a5a4b179b336f5079b57207';
                const url = `https://api.opencagedata.com/geocode/v1/json?q=${latitude}+${longitude}&key=${OPEN_CAGE_API_KEY}`;
    
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data && data.results && data.results.length > 0) {
                            const country = data.results[0].components.country;
                            localStorage.setItem("country", country);
                            console.log("Country:", country); // For debugging purposes
                        } else {
                            console.error('No results found');
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching country:', error);
                    });
            }
    
            acceptButton.addEventListener("click", function () {
                localStorage.setItem("name", nameInput.value);
                localStorage.setItem("selectedJobRole", jobSelectElement.value);
    
                // Make the black screen visible
                blackScreen.style.visibility = 'visible';
                blackScreen.style.opacity = 1;
    
                // Start the zoom and blur effect shortly after making the image visible
                setTimeout(() => {
                    skyImage.style.transform = 'scale(1.3)';
                    skyImage.style.filter = 'blur(0px)';
                }, 200);
    
                // Fade out after the set display time
                setTimeout(() => {
                    blackScreen.style.opacity = 0;
                    setTimeout(() => {
                        window.location.href = "home.html";
                    }, 250);
                }, 6000);
            });
    
            if (!sessionStorage.getItem("splashShown")) {
                sessionStorage.setItem("splashShown", "true");
                showSplashScreen();
            } else {
                window.location.href = "home.html";
            }
        });
    
        function showSplashScreen() {
            const logo1 = document.getElementById("logo1");
            const logo2 = document.getElementById("logo2");
            logo1.style.transform = "scale(0.8)";
            logo2.style.transform = "rotateX(-90deg)";
    
            setTimeout(() => {
                logo1.style.transform = "scale(1)";
                logo2.style.transform = "rotateX(0deg)";
            }, 100);
    
            setTimeout(() => {
                const splashScreen = document.querySelector(".splash-screen");
                const instructionScreen = document.querySelector(".instruction-screen");
                splashScreen.classList.remove("visible");
                splashScreen.classList.add("hidden");
                instructionScreen.classList.remove("hidden");
                instructionScreen.classList.add("visible");
            }, 6000);
        }
    </script>
    
</body>
</html>
